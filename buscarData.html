<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App YLOC_BuscarData V</title>
    <!-- Incluye el CDN de Tailwind CSS para un estilo rápido y moderno -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluye la librería de iconos Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.1/css/all.css">
    <!-- Incluye la librería Chart.js para los gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Importa la fuente Poppins de Google Fonts */
        @import url("https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800,900&display=swap");

        /* Definición de variables CSS para el tema claro */
        :root {
            --bg-color: #f0f2f5;
            --box-color: #e9ecef;
            --border-color: #dcdcdc;
            --text-color: #111;
            --link-color: #D61336;
            --accent-color-1: #4041C2;
            --accent-color-2: #7aebbc;
            --box-shadow-color: rgba(0,0,0,0.2);
        }

        /* Variables para el tema oscuro */
        body.dark-mode {
            --bg-color: #25252b;
             --box-color: #3a3a45;
            --border-color: #25252b;
            --text-color: #fff;
            --link-color: #4041C2;
            --accent-color-1: #4041C2;
            --accent-color-2: #dbeb7a;
            --box-shadow-color: rgba(255,255,255,0.15);
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Clases de utilidad para un código más limpio */
        .header-bg {
            background-color: var(--box-color);
        }
        /* **AJUSTE** La barra de navegación ahora usa el color del body */
        .nav-bg {
            background-color: var(--bg-color);
        }

        .box-shadow {
            box-shadow: 0 4px 6px -1px var(--box-shadow-color), 0 2px 4px -2px var(--box-shadow-color);
        }

        .box-shadow-up {
            box-shadow: 0 -4px 6px -1px var(--box-shadow-color), 0 -2px 4px -2px var(--box-shadow-color);
        }
        
        .accent-link {
            color: var(--link-color);
        }

        .icon-size {
            height: 1.5rem;
            width: 1.5rem;
        }
        
        .padding-container {
            padding: 0 1rem;
        }

        .flex-row {
            display: flex;
            align-items: center;
        }

        .flex-col {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .nav-link {
            padding: 0.5rem;
            border-radius: 9999px;
            transition: background-color 0.3s;
        }
        
        .nav-link:hover {
            background-color: none;
        }
        
        /* Estilos específicos para los elementos */
        .welcome-text {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .dashboard-box {
            padding: 1.5rem;
            border-radius: 0.5rem;
        }

        .list-items {
            list-style-type: disc;
            list-style-position: inside;
            margin-top: 1rem;
        }
        
        .toggle-switch-container {
            position: relative;
            width: 40px; 
            height: 22px;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            transform: translate3d(0, 0, 0);
            font-size: 1.1rem;
        }

        .toggle-switch-container:before {
            content: '';
            position: absolute;
            top: 0;
            width: 40px; 
            height: 22px;
            border-radius: 11px;
            background-color: var(--text-color);
            transition: background-color 0.3s cubic-bezier(0.86, 0, 0.07, 1);
        }

        .toggle-switch-container:active:before {
            transition: background-color 0.3s cubic-bezier(0.86, 0, 0.07, 1);
        }

        .toggle-switch-container .toggle-button {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px; 
            height: 18px;
            border-radius: 50%;
            background-color: var(--box-color);
            transition: transform 0.3s cubic-bezier(0.86, 0, 0.07, 1), background-color 0.3s cubic-bezier(0.86, 0, 0.07, 1);
        }

        .toggle-switch-container.dark-mode:before {
            background-color: var(--accent-color-1);
        }

        .toggle-switch-container.dark-mode .toggle-button {
            transform: translateX(18px);
            background-color: var(--box-color);
        }

        /* Estilos para la tabla con CSS Grid */
        .table-wrapper {
            overflow: auto; 
            max-width: 100%;
            /* MODIFICACIÓN: Se ha ajustado la altura máxima para que solo se muestren 20 registros (20 * 30px) */
            max-height: 600px;
            margin-top: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px var(--box-shadow-color), 0 2px 4px -2px var(--box-shadow-color);
            background-color: var(--box-color);
        }
        
        .data-grid {
            display: grid;
            grid-template-columns: repeat(10, auto);
            width: max-content;
        }

        .grid-header, .grid-cell {
            padding: 0.5rem; 
            height: 30px;
            display: flex;
            align-items: center;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Regla para centrar solo el texto de los encabezados */
        .grid-header {
            text-align: center;
            justify-content: center;
        }

        /* Ahora incluye la columna INGRESO y CÉDULA */
        .grid-cell.cedula-col,
        .grid-cell.ingreso-col {
            text-align: right;
            justify-content: flex-end;
        }

        /* Ahora incluye la columna INGRESO y CÉDULA */
        .grid-header.cedula-col,
        .grid-header.ingreso-col {
            text-align: center;
            justify-content: center;
        }

        .grid-row {
            display: contents; 
        }

        /* Fija la primera fila con encabezados */
        .grid-row:first-child .grid-header {
            position: sticky;
            top: 0;
            z-index: 20;
            background-color: var(--accent-color-1);
            font-weight: 600;
            color: #fff; 
            text-transform: uppercase;
        }
        
        /* Fija la primera columna */
        .grid-row > .grid-cell:first-child {
            position: sticky;
            left: 0;
            z-index: 30;
            background-color: var(--accent-color-1);
            color: #fff; /* Se ha cambiado el color del texto a blanco para la legibilidad */
        }

        /* Fija la celda en la esquina superior izquierda */
        .grid-row:first-child > .grid-header:first-child {
            position: sticky;
            left: 0;
            z-index: 40;
            background-color: var(--accent-color-1);
            color: #fff; /* Se ha cambiado el color del texto a blanco para la legibilidad */
        }
        
        .grid-cell:last-child, .grid-header:last-child {
            border-right: none;
        }

        /* Estilo para las filas pares en modo claro y oscuro, excluyendo la primera celda */
        :root .data-grid .grid-row:nth-child(even) > div:not(:first-child) {
            background-color: rgba(0,0,0,0.05);
        }
        body.dark-mode .data-grid .grid-row:nth-child(even) > div:not(:first-child) {
            background-color: rgba(255,255,255,0.05);
        }
        

        .data-grid .grid-row.data-row:hover .grid-cell {
            background-color: var(--accent-color-1) !important;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        /* Se ha corregido la regla para la fila seleccionada.
            El selector ahora es más específico para asegurar que anula otras reglas.
        */
        .data-grid .grid-row.selected-row .grid-cell {
            background-color: var(--accent-color-1) !important;
            color: #fff;
        }

        /* Efecto de hover y transición para los iconos de la barra de navegación inferior */
        .nav-link i, .nav-link span {
            transition: transform 0.3s ease-in-out, color 0.3s ease, text-shadow 0.3s ease;
            color: var(--text-color);
        }

        /* Efecto neón al pasar el cursor o tocar el elemento */
        .nav-link:hover i,
        .nav-link:hover span,
        .nav-link.active i,
        .nav-link.active span {
            transform: scale(1.1) translateY(-3px);
            color: var(--accent-color-1);
            text-shadow: 0 0 1px var(--accent-color-1), 0 0 5px var(--accent-color-1); /* Disminuimos el efecto de neón */
        }
        


        /* Estilo para el icono de cancelar */
        #clear-search:hover i {
            transform: scale(1.2);
            transition: transform 0.2s ease-in-out;
        }

        /* Regla específica para el botón de cerrar sesión que anula el cambio de color pero mantiene los demás efectos */
        .logout-link:hover i {
            color: var(--text-color);
            text-shadow: 0 0 2px var(--text-color), 0 0 10px var(--text-color), 0 0 15px var(--text-color);
        }
        
        /* Estilos para el spinner de carga */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: var(--accent-color-1);
            animation: spin 1s ease infinite;
            margin: 2rem auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Clase para ocultar los dashboards no activos */
        .hidden {
            display: none;
        }
        
        /* Estilos para la nueva barra de navegación superior con íconos */
        .nav-link-top {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            gap: 0.5rem; /* Espacio entre el ícono y el texto */
            color: var(--text-color);
        }

        .nav-link-top:hover {
            transform: translateY(-2px);
            color: var(--text-color);
            text-shadow: none;
        }

        .nav-link-top.active {
            color: var(--accent-color-1);
            text-shadow: none;
        }
        
        /* Estilos para el formulario modal */
        .form-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Fondo semitransparente */
            display: none; /* Oculto por defecto */
            justify-content: center;
            align-items: flex-start;
            z-index: 9999;
            /* padding superior para evitar que se solape con el cintillo */
            padding-top: 50px;
        }
        
        .form-content {
            background-color: var(--box-color);
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            /* Se ha añadido max-width y se ha actualizado el ancho del 100% */
            width: 100%;
            max-width: 500px;
            position: relative;
            /* Se ha añadido overflow: hidden para ocultar las ventanas que no están activas */
            overflow: hidden;
            /* Margin top para separar del borde superior */
            margin-top: 2rem;
        }

        /* Estilos para el contenedor de las ventanas del formulario */
        .form-windows {
            display: flex;
            transition: transform 0.5s ease-in-out;
            width: 100%;
        }
        
        /* Estilos para cada ventana */
        .form-window {
            width: 100%;
            flex-shrink: 0;
            position: relative; /* Añadido para posicionar el botón de cierre */
        }

        /* Los íconos de navegación ahora son absolutos */
        .nav-icon {
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-color);
            transition: color 0.2s, transform 0.2s;
        }

        .nav-icon:hover {
            color: var(--accent-color-1);
            transform: scale(1.1);
        }
        
        /* **NUEVOS ESTILOS** para los botones de navegación circulares */
        .circular-btn {
            background-color: var(--accent-color-1);
            color: #fff;
            border: none;
            border-radius: 50%;
            padding: 0.5rem;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .circular-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
        }
        
        .circular-btn svg {
            width: 1.5rem;
            height: 1.5rem;
            stroke: var(--text-color); /* Se ajusta el color del trazo del SVG para ser visible */
        }
        
        .dark-mode .circular-btn svg {
            stroke: #fff; /* En modo oscuro el trazo del SVG es blanco */
        }

        /* Clase para ocultar los botones de navegación */
        .circular-btn.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        .form-content h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }
        
        /* **AJUSTE** Se ha reducido el margen inferior para unir los grupos de campos */
        .form-group {
            margin-bottom: 0.5rem;
        }
        
        .form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-color);
            margin-bottom: 0.05rem;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            border-radius: 0.25rem;
            color: var(--text-color);
            font-size: 1rem;
        }

        /* Botón de cerrar para el formulario */
        /* **MODIFICADO** Ahora usa una clase para ser usado en múltiples botones */
        .close-form-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--text-color);
            transition: transform 0.2s;
            /* Se ha añadido padding inferior para aumentar la separación visual */
            padding-bottom: 0.5rem;
        }
        
        .close-form-btn:hover {
            transform: scale(1.2);
            color: var(--accent-color-1);
        }
        
        .form-step {
            width: 100%;
            flex-shrink: 0;
        }

        /* Media query para pantallas más grandes (mayor a 600px) */
        @media (min-width: 600px) {
            .dashboard-box {
                padding: 2.5rem;
            }

            .table-wrapper {
                /* MODIFICACIÓN: En pantallas más grandes, la altura máxima se ajusta para mostrar más registros */
                max-height: 70vh;
            }
            
            /* **NUEVO** Estilos para el enlace de navegación superior en escritorio */
            .nav-link-top-desktop {
                flex-direction: row;
                gap: 0.5rem;
                padding: 0.5rem 1rem; /* Padding horizontal para un mejor aspecto */
            }
        }
    </style>
</head>
<body class="dark-mode transition-colors">

    <!-- 1. Cintillo Fijo (Header) -->
    <header class="fixed top-0 left-0 w-full header-bg box-shadow z-50 transition-colors">
        <div class="container mx-auto padding-container py-3 flex items-center justify-between">
            <!-- Mensaje de Bienvenida (Asume que el usuario está logueado) -->
            <div class="flex-row space-x-2">
                <span class="welcome-text">¡Hola, Usuario!</span>
            </div>

            <div class="flex-row space-x-4">
                <!-- Botón de Modo Claro/Oscuro -->
                <div id="theme-toggle" class="toggle-switch-container dark-mode">
                    <div class="toggle-button"></div>
                </div>
                
                <!-- Botón para cerrar sesión -->
                <button class="nav-link logout-link">
                    <!-- Icono de cerrar sesión de Font Awesome -->
                    <i class="text-3xl fa-solid fa-right-from-bracket icon-size "></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Barra de navegación para los dashboards -->
    <nav class="fixed top-16 left-0 w-full nav-bg z-40 transition-colors py-4">
        <div class="container mx-auto padding-container py-2 flex justify-around items-center">
            <a href="#" class="nav-link-top nav-link-top-desktop" data-target="dashboard-two">
                <i class="fa-solid fa-users text-2xl py-2"></i>
                <span class="font-semibold text-sm">Datos del Personal</span>
            </a>
        </div>
    </nav>

    <!-- Contenedor principal para las diferentes secciones del dashboard -->
    <main class="pt-40 pb-20 px-4">
        <div class="container mx-auto py-6">
            <!-- Primer Dashboard (activo por defecto) -->
            <div id="dashboard-two" class="dashboard-section hidden">
                <h2 class="text-3xl font-bold mb-2 text-center">Caracterización de la Data</h2>
                <div class="dashboard-box header-bg box-shadow mb-8">
                    <!-- Contenedor del spinner y el gráfico -->
                    <!-- MODIFICADO: Se ha cambiado a w-full h-[50vh] -->
                    <div id="chart-container-wrapper" class="relative w-full h-[50vh]">
                        <!-- Spinner de carga -->
                        <div id="chart-spinner" class="spinner absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></div>
                        <!-- Gráfico de Chart.js (inicialmente oculto) -->
                        <canvas id="barChart" style="display: none;"></canvas>
                    </div>
                </div>
                
                <!-- Estructura de tabla para el segundo dashboard -->
                <div class="flex flex-col items-start mt-8">
                    <div class="flex items-center justify-between w-full">
                        <h3 class="text-2xl font-bold mb-2 text-center">Datos Básicos</h3>
                    </div>
                <!-- Motor de Búsqueda Dinámica -->
                <!-- Se ha reducido el margen superior para reducir el espacio con el elemento de arriba -->
                <div class="mt-2 mb-0 flex items-center justify-start gap-4 w-full">
                    <!-- **MODIFICADO** ID del campo de búsqueda a search-input-two -->
                    <input type="text" id="search-input-two" placeholder="Buscar información..."
                        class="flex-1 p-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-accent-color-1 transition-all"
                        style="background-color: var(--box-color); border: 1px solid var(--border-color); color: var(--text-color);">
                        
                    <!-- **MODIFICADO** ID del botón de cancelar a clear-search-two -->
                    <button id="clear-search-two"
                        class="p-2 rounded-full transition-all"
                        style="background-color: transparent; box-shadow: none;">
                        <i class="fa-solid fa-xmark text-3xl font-bold" style="color: var(--accent-color-1);"></i>
                    </button>
                    </div>               
                    <div class="table-wrapper w-full"> 
                        <div class="data-grid" id="Person-grid"> 
                            <!-- Header Row --> 
                            <div class="grid-row header-row"> 
                                <div class="grid-header">ID</div> 
                                <div class="grid-header">Empresa</div> 
                                <div class="grid-header">Nómina</div> 
                                <div class="grid-header">Apellidos</div> 
                                <div class="grid-header">Nombres</div> 
                                <div class="grid-header cedula-col">Cédula</div> 
                                <div class="grid-header">Cargo</div> 
                                <div class="grid-header ingreso-col">Ingreso</div> 
                                <div class="grid-header">Sector</div> 
                                <div class="grid-header">Perfil</div> 
                            </div>
                            <!-- Se añade un mensaje de carga inicial que será sustituido por los datos -->
                            <div class="grid-row">
                                <div class="grid-cell" style="grid-column: 1 / -1; text-align: center;">Cargando datos...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- **NUEVO** Formulario modal para mostrar los datos de la fila seleccionada -->
    <div id="data-form" class="form-container">
        <div class="form-content">
            <!-- Botón para cerrar el modal -->
            <button class="close-form-btn absolute top-0 right-2 text-2xl mb-4">&times;</button>
            
            <!-- Contenedor del encabezado con el título y los botones de navegación -->
            <!-- Se ha unificado en un solo contenedor para evitar duplicación -->
            <div id="header-container" class="flex items-center justify-between mb-6">
                <div id="navigation-icons" class="flex items-center space-x-2">
                    <!-- Botón de navegación a la izquierda (oculto por defecto) -->
                    <button id="prev-btn" class="circular-btn hidden" aria-label="Anterior">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <!-- Botón de navegación a la derecha -->
                    <button id="next-btn" class="circular-btn" aria-label="Siguiente">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
                <h3 class="text-2xl font-semibold text-text-color mb-10" id="form-title">Información Personal</h3>

            <form id="multi-step-form">
                <!-- **CORREGIDO** Se ha añadido el campo oculto `form-id` -->
                <input type="hidden" id="form-id">
                
                <div id="step-1" class="form-step">
                    <div class="form-group">
                        <label for="form-nombre">Nombres</label>
                        <input type="text" id="form-nombres" readonly>
                    </div>
                    <div class="form-group">
                        <label for="form-apellidos">Apellidos</label>
                        <input type="text" id="form-apellidos" readonly>
                    </div>
                    <div class="form-group">
                        <label for="form-empresa">Empresa</label>
                        <input type="text" id="form-empresa" readonly>
                    </div>
                    <div class="form-group">
                        <label for="form-nomina">Nómina</label>
                        <input type="text" id="form-nomina" readonly>
                    </div>
                </div>
                
                <div id="step-2" class="form-step hidden">
                    <div class="form-group">
                        <label for="form-cedula">Cédula</label>
                        <input type="text" id="form-cedula" readonly>
                    </div>
                    <div class="form-group">
                        <label for="form-cargo">Cargo</label>
                        <input type="text" id="form-cargo" readonly>
                    </div>
                    <div class="form-group">
                        <label for="form-ingreso">Ingreso</label>
                        <input type="text" id="form-ingreso" readonly>
                    </div>
                    <div class="form-group">
                        <label for="form-sector">Sector</label>
                        <input type="text" id="form-sector" readonly>
                    </div>
                </div>
            </form>
        </div>
    </div>


    <!-- 3. Barra de Navegación Fija (Footer) -->
    <nav class="fixed bottom-0 left-0 w-full nav-bg box-shadow-up z-50 transition-colors">
        <div class="container mx-auto padding-container py-1 flex justify-around items-center">
            <!-- Botón de Inicio -->
            <a href="#" class="flex-col nav-link accent-link justify-center gap-1">
                <i class="fa-solid fa-house icon-size"></i>
                <span class="link-text">Inicio</span>
            </a>

            <!-- Botón de Buscar -->
            <a href="#" class="flex-col nav-link justify-center gap-1">
                <i class="fa-solid fa-magnifying-glass icon-size"></i>
                <span class="link-text">Buscar</span>
            </a>

            <!-- Botón de Perfil -->
            <a href="#" class="flex-col nav-link justify-center gap-1">
                <i class="fa-solid fa-user icon-size"></i>
                <span class="link-text">Perfil</span>
            </a>

            <!-- Botón de Nuevo -->
            <a href="#" class="flex-col nav-link justify-center gap-1">
                <i class="fa-solid fa-plus icon-size"></i>
                <span class="link-text">Nuevo</span>
            </a>
        </div>
    </nav>

    <script>
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;
        
        // **NUEVO** Elementos del formulario
        const dataForm = document.getElementById('data-form');
        const closeFormBtns = document.querySelectorAll('.close-form-btn'); // Se ha cambiado a querySelectorAll
        // Se ha ajustado para el nuevo HTML
        const formId = document.getElementById('form-id');
        const formNombres = document.getElementById('form-nombres');
        const formApellidos = document.getElementById('form-apellidos');
        const formEmpresa = document.getElementById('form-empresa');
        const formNomina = document.getElementById('form-nomina');
        const formCedula = document.getElementById('form-cedula');
        const formCargo = document.getElementById('form-cargo');
        const formIngreso = document.getElementById('form-ingreso');
        const formSector = document.getElementById('form-sector');
        
        // Cargar el tema guardado al iniciar
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme) {
            body.classList.add(currentTheme + '-mode');
            themeToggle.classList.add(currentTheme + '-mode');
        } else {
            // Establecer el modo oscuro como predeterminado si no hay preferencia
            body.classList.add('dark-mode');
            themeToggle.classList.add('dark-mode');
        }
        
        themeToggle.addEventListener('click', () => {
            const isDarkMode = body.classList.contains('dark-mode');
            if (isDarkMode) {
                body.classList.remove('dark-mode');
                themeToggle.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark-mode');
                themeToggle.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
            }
        });

        // **MODIFICADO** Lógica para el motor de búsqueda dinámico (ahora es una función reutilizable)
        /**
         * Filtra las filas de una tabla basándose en un término de búsqueda.
         * @param {string} searchTerm - El término de búsqueda en minúsculas.
         * @param {HTMLElement} tableElement - El elemento del contenedor de la tabla.
         */
        function filterTable(searchTerm, tableElement) {
            const dataRows = tableElement.querySelectorAll('.data-grid .data-row');
            dataRows.forEach(row => {
                const cells = row.querySelectorAll('.grid-cell');
                let foundMatch = false;
                cells.forEach(cell => {
                    const cellText = cell.textContent.toLowerCase();
                    if (cellText.includes(searchTerm)) {
                        foundMatch = true;
                    }
                });
                row.style.display = foundMatch ? 'contents' : 'none';
            });
        }
        
        // **NUEVO** Asignar la lógica de búsqueda a cada dashboard
        const searchInputTwo = document.getElementById('search-input-two');
        const clearButtonTwo = document.getElementById('clear-search-two');
        const PersonGrid = document.getElementById('Person-grid');
        
        // Listener para el segundo dashboard
        searchInputTwo.addEventListener('input', () => {
            filterTable(searchInputTwo.value.toLowerCase(), PersonGrid);
        });
        
        clearButtonTwo.addEventListener('click', () => {
            searchInputTwo.value = '';
            filterTable('', PersonGrid);
        });

        // Lógica para la navegación y selección de filas
        const navLinks = document.querySelectorAll('[data-target]');
        const dashboardSections = document.querySelectorAll('.dashboard-section');
        
        function showDashboard(targetId) {
            dashboardSections.forEach(section => {
                section.classList.add('hidden');
            });
            const targetDashboard = document.getElementById(targetId);
            if (targetDashboard) {
                targetDashboard.classList.remove('hidden');
            }
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-target') === targetId) {
                    link.classList.add('active');
                }
            });
        }
        
        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const targetId = link.getAttribute('data-target');
                showDashboard(targetId);
            });
        });

        window.addEventListener('DOMContentLoaded', () => {
            // **MODIFICADO** Ahora se muestra el dashboard 'dashboard-two' por defecto
            showDashboard('dashboard-two');
        });
        
        const step1 = document.getElementById('step-1');
        const step2 = document.getElementById('step-2');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const formTitle = document.getElementById('form-title');
        
        let formSteps = [step1, step2];
        let currentStepIndex = 0;

        function showStep(stepIndex) {
            formSteps.forEach(step => {
                step.classList.add('hidden');
            });
            formSteps[stepIndex].classList.remove('hidden');
            currentStepIndex = stepIndex;
            updateFormUI();
        }

        function updateFormUI() {
            if (currentStepIndex === 0) {
                formTitle.textContent = 'Información Personal';
            } else if (currentStepIndex === 1) {
                formTitle.textContent = 'Información Adicional';
            }
            if (currentStepIndex === 0) {
                prevBtn.classList.add('hidden');
            } else {
                prevBtn.classList.remove('hidden');
            }
            if (currentStepIndex === formSteps.length - 1) {
                nextBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>`;
            } else {
                nextBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                    </svg>`;
            }
        }
        
        nextBtn.addEventListener('click', () => {
            if (currentStepIndex < formSteps.length - 1) {
                showStep(currentStepIndex + 1);
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentStepIndex > 0) {
                showStep(currentStepIndex - 1);
            }
        });

        function populateForm(rowData) {
            formId.value = rowData.id;
            formNombres.value = rowData.nombres;
            formApellidos.value = rowData.apellidos;
            formEmpresa.value = rowData.empresa;
            formNomina.value = rowData.nomina;
            formCedula.value = rowData.cedula;
            formCargo.value = rowData.cargo;
            formIngreso.value = rowData.ingreso;
            formSector.value = rowData.sector;
        }
        
        // **NUEVO** Lógica de evento para la tabla dinámica (Dashboard Dos)
        PersonGrid.addEventListener('click', (event) => {
            const row = event.target.closest('.data-row');
            if (row) {
                const selectedRow = PersonGrid.querySelector('.selected-row');
                if (selectedRow) {
                    selectedRow.classList.remove('selected-row');
                }
                row.classList.add('selected-row');
                
                const cells = row.querySelectorAll('.grid-cell');
                const rowData = {
                    id: cells[0].textContent,
                    empresa: cells[1].textContent,
                    nomina: cells[2].textContent,
                    apellidos: cells[3].textContent,
                    nombres: cells[4].textContent,
                    cedula: cells[5].textContent,
                    cargo: cells[6].textContent,
                    ingreso: cells[7].textContent,
                    sector: cells[8].textContent,
                    perfil: cells[9].textContent
                };
                
                populateForm(rowData);
                dataForm.style.display = 'flex';
                showStep(0);
            }
        });
        
        closeFormBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                dataForm.style.display = 'none';
            });
        });
        
        // Código para la tabla del segundo dashboard, integrado desde el fragmento proporcionado
        document.addEventListener("DOMContentLoaded", () => {
            
            // La URL de tu script de Google Apps
            const GAS_URL = 'https://script.google.com/macros/s/AKfycbx87WvxA9ca1KyGMA1wsw1npZw5vPtjoItomhF823BICXScNrWGFh5m0Dj6Veb24CtHXQ/exec';

            // Mapeo de los encabezados del HTML a las claves de los datos JSON
            const headerMapping = {
                'ID': 'ID',
                'Empresa': 'EMPRESA',
                'Nómina': 'NOMINA',
                'Apellidos': 'APELLIDOS',
                'Nombres': 'NOMBRES',
                'Cédula': 'CÉDULA',
                'Cargo': 'CARGO',
                'Ingreso': 'INGRESO',
                'Sector': 'SECTOR',
                'Perfil': 'PERFIL'
            };

            /**
             * Función asíncrona para cargar los datos desde la fuente externa.
             */
            async function loadPersonData() {
                console.log("Cargando datos de vacaciones...");
                
                try {
                    const response = await fetch(`${GAS_URL}?sheet=V¿BD_Personal`);
                    const result = await response.json();

                    if (result.error) {
                        PersonGrid.innerHTML = `
                        <div class="grid-row header-row">
                          <div class="grid-header">ID</div>
                          <div class="grid-header">Empresa</div>
                          <div class="grid-header">Nómina</div>
                          <div class="grid-header">Apellidos</div>
                          <div class="grid-header">Nombres</div>
                          <div class="grid-header cedula-col">Cédula</div>
                          <div class="grid-header">Cargo</div>
                          <div class="grid-header">Ingreso</div>
                          <div class="grid-header">Sector</div>
                          <div class="grid-header">Perfil</div>
                        </div>
                        <div class="grid-row">
                            <div class="grid-cell" style="grid-column: 1 / -1; text-align: center; color: red;">Error de la API: ${result.error}</div>
                        </div>`;
                        console.error('GAS API Error:', result.error);
                        return;
                    }

                    const allData = result.data;
                    renderTable(allData);
                    console.log("Datos de vacaciones cargados correctamente.");

                } catch (error) {
                    PersonGrid.innerHTML = `
                    <div class="grid-row header-row">
                      <div class="grid-header">ID</div>
                      <div class="grid-header">Empresa</div>
                      <div class="grid-header">Nómina</div>
                      <div class="grid-header">Apellidos</div>
                      <div class="grid-header">Nombres</div>
                      <div class="grid-header cedula-col">Cédula</div>
                      <div class="grid-header">Cargo</div>
                      <div class="grid-header">Ingreso</div>
                      <div class="grid-header">Sector</div>
                      <div class="grid-header">Perfil</div>
                    </div>
                    <div class="grid-row">
                        <div class="grid-cell" style="grid-column: 1 / -1; text-align: center; color: red;">No se pudo conectar con el script. Por favor, asegúrese de que la URL sea correcta.</div>
                    </div>`;
                    console.error('Fetch Error:', error);
                }
            }
           
            // Función para formatear la fecha a dd/mm/aaaa
            function formatDate(date) {
                const d = new Date(date);
                const day = String(d.getDate()).padStart(2, '0');
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const year = d.getFullYear();
                return `${day}/${month}/${year}`;
            }


            /**
             * Función para construir y mostrar la tabla a partir de los datos.
             * Se ha modificado para incluir el correlativo en la columna ID.
             * @param {Array<Object>} data - Un array de objetos con los datos de la tabla.
             */
            function renderTable(data) {
                // Elimina el mensaje de carga o los datos anteriores
                Array.from(PersonGrid.children).forEach(child => {
                    if (!child.classList.contains('header-row')) {
                        child.remove();
                    }
                });

                if (!data || data.length === 0) {
                    const noDataRow = document.createElement('div');
                    noDataRow.className = 'grid-row';
                    noDataRow.innerHTML = '<div class="grid-cell" style="grid-column: 1 / -1; text-align: center;">No hay datos para mostrar.</div>';
                    PersonGrid.appendChild(noDataRow);
                    return;
                }
                
                const gridHeaders = document.querySelectorAll('#Person-grid .grid-header');
                const cedulaIndex = Array.from(gridHeaders).findIndex(header => header.textContent.trim() === 'Cédula');
                const ingresoIndex = Array.from(gridHeaders).findIndex(header => header.textContent.trim() === 'Ingreso');

                // Recorre cada fila (objeto) en los datos
                data.forEach((row, index) => {
                    const gridRow = document.createElement('div');
                    gridRow.className = 'grid-row data-row';
                    gridRow.dataset.id = (index + 1);

                    // Crea la celda del ID con el número correlativo
                    const idCell = document.createElement('div');
                    idCell.className = 'grid-cell';
                    idCell.textContent = (index + 1);
                    gridRow.appendChild(idCell);

                    // Crea el resto de las celdas, excluyendo el ID del mapeo
                    Object.keys(headerMapping).slice(1).forEach((key, colIndex) => {
                        const cell = document.createElement('div');
                        cell.className = 'grid-cell';
                        const jsonKey = headerMapping[key];
                        let cellContent = row[jsonKey] || '';
                        
                        // Si es la columna de Ingreso, formatea la fecha y añade la clase
                        if (key === 'Ingreso') {
                            cellContent = formatDate(cellContent);
                            cell.classList.add('ingreso-col');
                        }

                        // Si es la columna Cédula, añade la clase de justificación
                        if (colIndex === cedulaIndex - 1) { // El índice del bucle no incluye el ID, por eso se resta 1
                           cell.classList.add('cedula-col');
                        }
            
                        cell.textContent = cellContent;
                        
                        gridRow.appendChild(cell);
                    });
                    PersonGrid.appendChild(gridRow);
                });
            }
            
            // Llama a la función para iniciar la carga de datos al cargar la página
            loadPersonData();
        });
        
    </script>

    <script>
        // Lógica para cargar y renderizar el gráfico de barras verticales
        async function loadChartData() {
            console.log("Cargando datos para el gráfico...");
            
            // Obtiene las referencias a los elementos del DOM
            const spinner = document.getElementById('chart-spinner');
            const chartCanvas = document.getElementById('barChart');
            const chartContainerWrapper = document.getElementById('chart-container-wrapper');

            // Muestra el spinner y oculta el canvas
            spinner.style.display = 'block';
            chartCanvas.style.display = 'none';

            const GAS_URL_CHART = 'https://script.google.com/macros/s/AKfycbx87WvxA9ca1KyGMA1wsw1npZw5vPtjoItomhF823BICXScNrWGFh5m0Dj6Veb24CtHXQ/exec';

            try {
                const response = await fetch(`${GAS_URL_CHART}?sheet=V¿BD_Personal`);
                const result = await response.json();

                if (result.error) {
                    // Oculta el spinner y muestra el error
                    spinner.style.display = 'none';
                    chartContainerWrapper.innerHTML = `<p class="text-center text-red-500">Error: No se pudo cargar el gráfico. Verifique la URL de los datos.</p>`;
                    console.error('GAS API Error:', result.error);
                    return;
                }

                const allData = result.data;
                const counts = {};
                
                allData.forEach(row => {
                    const category = row['EMPRESA'] || 'Sin Empresa';
                    counts[category] = (counts[category] || 0) + 1;
                });
                
                const labels = Object.keys(counts);
                const values = Object.values(counts);

                const ctx = chartCanvas.getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Cantidad',
                            data: values,
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.6)',
                                'rgba(54, 162, 235, 0.6)',
                                'rgba(255, 206, 86, 0.6)',
                                'rgba(75, 192, 192, 0.6)',
                                'rgba(153, 102, 255, 0.6)',
                                'rgba(255, 159, 64, 0.6)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false // Oculta la leyenda
                            },
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Cantidad'
                                }
                            },
                            x: {
                                display: false // Agregamos esta línea para ocultar completamente el eje X
                            }
                        }
                    }
                });

                // Oculta el spinner y muestra el canvas después de que el gráfico se ha creado
                spinner.style.display = 'none';
                chartCanvas.style.display = 'block';

            } catch (error) {
                console.error("Error al cargar o procesar los datos del gráfico:", error);
                // Oculta el spinner y muestra el error
                spinner.style.display = 'none';
                chartContainerWrapper.innerHTML = `<p class="text-center text-red-500">Error: No se pudo cargar el gráfico. Verifique la URL de los datos.</p>`;
            }
        }
        
        // Carga el gráfico al cargar la página
        window.addEventListener('load', loadChartData);
    </script>
</body>
</html>
